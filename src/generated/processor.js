!function(){"use strict";!function(e){function t(){}function n(){}t.prototype.encode=function(e){const t=[],n=e.length;let o=0;for(;o<n;){const n=e.codePointAt(o);let r=0,s=0;for(n<=127?(r=0,s=0):n<=2047?(r=6,s=192):n<=65535?(r=12,s=224):n<=2097151&&(r=18,s=240),t.push(s|n>>r),r-=6;r>=0;)t.push(128|n>>r&63),r-=6;o+=n>=65536?2:1}return t},globalThis.TextEncoder=t,e.TextEncoder||(e.TextEncoder=t),n.prototype.decode=function(e){if(!e)return"";let t="",n=0;for(;n<e.length;){let o=e[n],r=0,s=0;if(o<=127?(r=0,s=255&o):o<=223?(r=1,s=31&o):o<=239?(r=2,s=15&o):o<=244&&(r=3,s=7&o),e.length-n-r>0){let t=0;for(;t<r;)o=e[n+t+1],s=s<<6|63&o,t+=1}else s=65533,r=e.length-n;t+=String.fromCodePoint(s),n+=r+1}return t},globalThis.TextDecoder=n,e.TextDecoder||(e.TextDecoder=n)}("undefined"==typeof globalThis?"undefined"==typeof global?"undefined"==typeof self?void 0:self:global:globalThis);let e;const t=new Array(128).fill(void 0);function n(e){return t[e]}t.push(void 0,null,!0,!1);let o=t.length;function r(e){const r=n(e);return function(e){e<132||(t[e]=o,o=e)}(e),r}function s(e){o===t.length&&t.push(t.length+1);const n=o;return o=t[n],t[n]=e,n}function i(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let n="[";t>0&&(n+=i(e[0]));for(let o=1;o<t;o++)n+=", "+i(e[o]);return n+="]",n}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let o;if(!(n.length>1))return toString.call(e);if(o=n[1],"Object"==o)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:o}let c=0,a=null;function l(){return null!==a&&0!==a.byteLength||(a=new Uint8Array(e.memory.buffer)),a}const u="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},f="function"==typeof u.encodeInto?function(e,t){return u.encodeInto(e,t)}:function(e,t){const n=u.encode(e);return t.set(n),{read:e.length,written:n.length}};let d=null;function h(){return null!==d&&0!==d.byteLength||(d=new Int32Array(e.memory.buffer)),d}const b="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};function y(e){return null==e}"undefined"!=typeof TextDecoder&&b.decode();class g{static __wrap(e){e>>>=0;const t=Object.create(g.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const t=this.__destroy_into_raw();e.__wbg_soundfont2synthesizer_free(t)}constructor(t,n){const o=function(e,t){const n=t(1*e.length,1)>>>0;return l().set(e,n/1),c=e.length,n}(t,e.__wbindgen_malloc),r=c,s=e.soundfont2synthesizer_new(o,r,n);return g.__wrap(s)}noteOn(t,n,o){e.soundfont2synthesizer_noteOn(this.__wbg_ptr,t,n,!y(o),y(o)?0:o)}noteOff(t,n){e.soundfont2synthesizer_noteOff(this.__wbg_ptr,t,!y(n),y(n)?0:n)}nextBlock(t){return r(e.soundfont2synthesizer_nextBlock(this.__wbg_ptr,t))}}function p(){const t={wbg:{}};return t.wbg.__wbindgen_object_drop_ref=function(e){r(e)},t.wbg.__wbindgen_number_new=function(e){return s(e)},t.wbg.__wbg_new_898a68150f225f2e=function(){return s(new Array)},t.wbg.__wbg_set_502d29070ea18557=function(e,t,o){n(e)[t>>>0]=r(o)},t.wbg.__wbindgen_debug_string=function(t,o){const r=function(e,t,n){if(void 0===n){const n=u.encode(e),o=t(n.length,1)>>>0;return l().subarray(o,o+n.length).set(n),c=n.length,o}let o=e.length,r=t(o,1)>>>0;const s=l();let i=0;for(;i<o;i++){const t=e.charCodeAt(i);if(t>127)break;s[r+i]=t}if(i!==o){0!==i&&(e=e.slice(i)),r=n(r,o,o=i+3*e.length,1)>>>0;const t=l().subarray(r+i,r+o);i+=f(e,t).written}return c=i,r}(i(n(o)),e.__wbindgen_malloc,e.__wbindgen_realloc),s=c;h()[t/4+1]=s,h()[t/4+0]=r},t.wbg.__wbindgen_throw=function(e,t){throw new Error((n=e,o=t,n>>>=0,b.decode(l().subarray(n,n+o))));var n,o},t}async function _(t){if(void 0!==e)return e;void 0===t&&(t=new URL("synthesizers_bg.wasm",document.currentScript&&document.currentScript.src||new URL("processor.js",document.baseURI).href));const n=p();("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t));const{instance:o,module:r}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}(await t,n);return function(t,n){return e=t.exports,_.__wbindgen_wasm_module=n,d=null,a=null,e}(o,r)}function w(e,t){return Math.round(e*t)}class m extends AudioWorkletProcessor{constructor(){super(),Object.defineProperty(this,"sampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"synth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sf2Bytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_port",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.port.onmessage=e=>{this.onmessageForSetup(e)},this.sampleRate=void 0,this.synth=void 0,this.sf2Bytes=void 0}onmessageForSetup(e){const t=e.data;let n;switch(t.type){case"sendWasmModule":_(WebAssembly.compile(t.wasmBytes)).then((()=>{this.port.postMessage({type:"loadedWasmModule"})})).catch((()=>{console.error("An error occurred during wasm initialization")})),this.sf2Bytes=t.sf2Bytes;break;case"initializeSynthesizer":if(null==this.sf2Bytes)throw new Error("sf2Bytes is undefined");this.sampleRate=t.sampleRate,this.synth=new g(new Uint8Array(this.sf2Bytes),t.sampleRate),n={type:"initializedSynthesizer"},this.port.postMessage(n);break;case"connectToPort":this._port=e.ports[0],this._port.onmessage=e=>{this.onmessage(e)},n={type:"connectedToPort"},this.port.postMessage(n)}}onmessage(e){const t=e.data;switch(t.type){case"noteOn":this.noteOn(t.key,t.vel,t.delayTime);break;case"noteOff":this.noteOff(t.key,t.delayTime)}}noteOn(e,t,n){void 0!==this.sampleRate&&void 0!==this.synth&&this.synth.noteOn(e,t,w(n??0,this.sampleRate))}noteOff(e,t){void 0!==this.sampleRate&&void 0!==this.synth&&this.synth.noteOff(e,w(t??0,this.sampleRate))}process(e,t){if(void 0===this.synth)return!0;const n=t[0],o=n[0].length,r=this.synth.nextBlock(o);return n[0].set(r[0]),n.length>1&&n[1].set(r[1]),!0}}registerProcessor("sf2-synth-processor",m)}();
//# sourceMappingURL=processor.js.map
